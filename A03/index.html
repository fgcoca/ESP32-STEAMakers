<!doctype html><html lang=es class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Estas notas se dedican a la programación de la placa de control ESP32 Plus STEAMakers por si misma o junto con la shield Imagina TDR STEAM y otros equipamientos y todo on ArduinoBlocks"><meta name=author content="Federico Coca"><link href=https://fgcoca.github.io/ESP32-STEAMakers/A03/ rel=canonical><link rel=icon href=../img/favicon.png><meta name=generator content="mkdocs-1.4.0, mkdocs-material-8.5.6"><title>Actividad-03. Parpadeo intermitente - Notas sobre ESP32 STEAMakers</title><link rel=stylesheet href=../assets/stylesheets/main.20d9efc8.min.css><link rel=stylesheet href=../assets/stylesheets/palette.cbb835fc.min.css><meta name=theme-color content=#02a6f2><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme data-md-color-primary=light-blue data-md-color-accent=deep-purple> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#actividad-03-parpadeo-intermitente-multitarea class=md-skip> Saltar a contenido </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Cabecera> <a href=.. title="Notas sobre ESP32 STEAMakers" class="md-header__button md-logo" aria-label="Notas sobre ESP32 STEAMakers" data-md-component=logo> <img src=../img/favicon.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Notas sobre ESP32 STEAMakers </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Actividad-03. Parpadeo intermitente </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Búsqueda placeholder=Búsqueda autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Limpiar aria-label=Limpiar tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Inicializando búsqueda </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/fgcoca/ESP32-STEAMakers title="Ir al repositorio" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> fgcoca/ESP32-STEAMakers </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navegación data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="Notas sobre ESP32 STEAMakers" class="md-nav__button md-logo" aria-label="Notas sobre ESP32 STEAMakers" data-md-component=logo> <img src=../img/favicon.png alt=logo> </a> Notas sobre ESP32 STEAMakers </label> <div class=md-nav__source> <a href=https://github.com/fgcoca/ESP32-STEAMakers title="Ir al repositorio" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> fgcoca/ESP32-STEAMakers </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> Introducción </a> </li> <li class=md-nav__item> <a href=../necesidades/ class=md-nav__link> Lo que vamos a necesitar </a> </li> <li class=md-nav__item> <a href=../importante/ class=md-nav__link> Información importante </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Algo de teoría <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Algo de teoría" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Algo de teoría </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../soft/ class=md-nav__link> Software </a> </li> <li class=md-nav__item> <a href=../htdr/ class=md-nav__link> Hardware TdR STEAM </a> </li> <li class=md-nav__item> <a href=../hsteamakers/ class=md-nav__link> Hardware ESP32 STEAMakers </a> </li> <li class=md-nav__item> <a href=../operadores/ class=md-nav__link> Operadores en programación C++ </a> </li> <li class=md-nav__item> <a href=../IoT_basico/ class=md-nav__link> Teoría básica de IoT </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5> Sensores digitales en la TdR STEAM <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Sensores digitales en la TdR STEAM" data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Sensores digitales en la TdR STEAM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../A01/ class=md-nav__link> Actividad-01. LED </a> </li> <li class=md-nav__item> <a href=../A02/ class=md-nav__link> Actividad-02. LEDs rojo y azul </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Actividad-03. Parpadeo intermitente <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Actividad-03. Parpadeo intermitente </a> <nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Tabla de contenidos </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#enunciado class=md-nav__link> Enunciado </a> </li> <li class=md-nav__item> <a href=#teoria class=md-nav__link> Teoría </a> <nav class=md-nav aria-label=Teoría> <ul class=md-nav__list> <li class=md-nav__item> <a href=#conceptos-basicos-de-multitarea class=md-nav__link> Conceptos básicos de multitarea </a> </li> <li class=md-nav__item> <a href=#programacion class=md-nav__link> Programación </a> </li> <li class=md-nav__item> <a href=#planificadores class=md-nav__link> Planificadores </a> </li> <li class=md-nav__item> <a href=#semaforos class=md-nav__link> Semáforos </a> </li> <li class=md-nav__item> <a href=#en-la-esp32-steamakers class=md-nav__link> En la ESP32 STEAMakers </a> </li> <li class=md-nav__item> <a href=#bloques-esperar class=md-nav__link> Bloques esperar </a> </li> <li class=md-nav__item> <a href=#bloques class=md-nav__link> Bloques </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#en-la-tdr-steam class=md-nav__link> En la TdR STEAM </a> </li> <li class=md-nav__item> <a href=#programando-la-actividad class=md-nav__link> Programando la Actividad </a> </li> <li class=md-nav__item> <a href=#retos-de-ampliacion class=md-nav__link> Retos de ampliación </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../A04/ class=md-nav__link> Actividad-04. LED RGB </a> </li> <li class=md-nav__item> <a href=../A05/ class=md-nav__link> Actividad-05. Zumbador </a> </li> <li class=md-nav__item> <a href=../A06/ class=md-nav__link> Actividad-06. Pulsadores </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> Sensores analógicos en la TdR STEAM <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Sensores analógicos en la TdR STEAM" data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Sensores analógicos en la TdR STEAM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../A07/ class=md-nav__link> Actividad-07. El potenciómetro </a> </li> <li class=md-nav__item> <a href=../A08/ class=md-nav__link> Actividad-08. La fotorresistencia o LDR </a> </li> <li class=md-nav__item> <a href=../A09/ class=md-nav__link> Actividad-09. El sensor de temperatura LM35D </a> </li> <li class=md-nav__item> <a href=../A10/ class=md-nav__link> Actividad-10. El sensor de temperatura y humedad DHT-11 </a> </li> <li class=md-nav__item> <a href=../A11/ class=md-nav__link> Actividad-11. Emisor y receptor de infrarrojos </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> Mas elementos del kit <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Mas elementos del kit" data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Mas elementos del kit </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../servo/ class=md-nav__link> El servo </a> </li> <li class=md-nav__item> <a href=../LCD1602/ class=md-nav__link> Puerto de expansión I2C. La LCD de 2x16 </a> </li> <li class=md-nav__item> <a href=../sonido/ class=md-nav__link> Sensor de sonido o micrófono </a> </li> <li class=md-nav__item> <a href=../evita_obs/ class=md-nav__link> Sensor infrarrojo para evitar obstáculos </a> </li> <li class=md-nav__item> <a href=../neopixel/ class=md-nav__link> LEDs RGB direccionables </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8 type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8> Otros dispositivos I2C <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Otros dispositivos I2C" data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Otros dispositivos I2C </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../matriz8x8/ class=md-nav__link> Matriz de LEDs </a> </li> <li class=md-nav__item> <a href=../color/ class=md-nav__link> Sensor de color </a> </li> <li class=md-nav__item> <a href=../gestos/ class=md-nav__link> Sensor de gestos </a> </li> <li class=md-nav__item> <a href=../rfid/ class=md-nav__link> Sensor RFID </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_9 type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9> Miscelanea <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Miscelanea data-md-level=1> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Miscelanea </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Miscelanea/about/ class=md-nav__link> Autor </a> </li> <li class=md-nav__item> <a href=../Miscelanea/lic/ class=md-nav__link> Licencias </a> </li> <li class=md-nav__item> <a href=../Miscelanea/webgrafia/ class=md-nav__link> Webgrafia/Bibliografía </a> </li> <li class=md-nav__item> <a href=../Miscelanea/soft/ class=md-nav__link> Software utilizado </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Tabla de contenidos </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#enunciado class=md-nav__link> Enunciado </a> </li> <li class=md-nav__item> <a href=#teoria class=md-nav__link> Teoría </a> <nav class=md-nav aria-label=Teoría> <ul class=md-nav__list> <li class=md-nav__item> <a href=#conceptos-basicos-de-multitarea class=md-nav__link> Conceptos básicos de multitarea </a> </li> <li class=md-nav__item> <a href=#programacion class=md-nav__link> Programación </a> </li> <li class=md-nav__item> <a href=#planificadores class=md-nav__link> Planificadores </a> </li> <li class=md-nav__item> <a href=#semaforos class=md-nav__link> Semáforos </a> </li> <li class=md-nav__item> <a href=#en-la-esp32-steamakers class=md-nav__link> En la ESP32 STEAMakers </a> </li> <li class=md-nav__item> <a href=#bloques-esperar class=md-nav__link> Bloques esperar </a> </li> <li class=md-nav__item> <a href=#bloques class=md-nav__link> Bloques </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#en-la-tdr-steam class=md-nav__link> En la TdR STEAM </a> </li> <li class=md-nav__item> <a href=#programando-la-actividad class=md-nav__link> Programando la Actividad </a> </li> <li class=md-nav__item> <a href=#retos-de-ampliacion class=md-nav__link> Retos de ampliación </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=actividad-03-parpadeo-intermitente-multitarea><font color=#8B008B>Actividad-03. Parpadeo intermitente. Multitarea</font><a class=headerlink href=#actividad-03-parpadeo-intermitente-multitarea title="Permanent link">&para;</a></h1> <h2 id=enunciado><font color=#007575>Enunciado</font><a class=headerlink href=#enunciado title="Permanent link">&para;</a></h2> <p>Ya hemos visto como hacer funcionar a los LEDs de diferentes formas, pero ahora vamos a introducir un concepto que nos puede resultar bastante útil en el futuro, se trata de la multitarea en ArduinoBlocks.</p> <h2 id=teoria><font color=#007575>Teoría</font><a class=headerlink href=#teoria title="Permanent link">&para;</a></h2> <p>Este apartado se extrae de ArduinoBlocks - FreeBook disponible en <a href=https://docs.google.com/document/u/1/d/e/2PACX-1vQSrOKHpbLQHVbGFdAvp7DcndoftoHDI20nvwGMaxu_7bGc1bUCmi4U6DZrJWRSudc2iXBg43QMuzCT/pub>Free Book (online &amp; updated)</a>.</p> <p>ArduinoBlocks nos permite utilizar una capa para implementar un sistema multitarea avanzado basado en FreeRTOS (del inglés Real Time Operating System), que es un sistema operativo de tiempo real kernel para dispositivos embebidos para plataformas de microcontrolador que se distribuye bajo licencia MIT. Este sistema permite crear tareas que se ejecutarán de forma paralela (virtualmente). En microcontroladores modestos como el Arduino UNO, Nano o incluso MEGA la multitarea con FreeRTOS es bastante limitada y consume gran parte de los recursos de nuestro Arduino, en caso de necesitar de un sistema multitarea más potente podemos optar por usarlo en placas basadas en ESP8266 o ESP32 con mucha más potencia y recursos (especialmente el ESP32 con doble núcleo y gran potencia de procesamiento y memoria interna)</p> <p><em>Los sistemas software de multitarea utilizan un planificador o scheduler que se encarga de repartir el tiempo de procesamiento entre las distintas tareas, de forma que a cada una le toca un tiempo de microcontrolador para ejecutar un poquito de su parte de programa.</em></p> <p>En las web de <a href=https://www.freertos.org/implementation/a00002.html>freeRTOS</a>, en su entrada de menú Kernel podemos encontrar los conceptos básicos de multitarea y de programación que vamos a extractar seguidamente.</p> <h3 id=conceptos-basicos-de-multitarea><font color=#AA0000>Conceptos básicos de multitarea</font><a class=headerlink href=#conceptos-basicos-de-multitarea title="Permanent link">&para;</a></h3> <p>Un procesador convencional como el de Arduino UNO solo puede ejecutar una tarea a la vez, pero al cambiar rápidamente entre tareas, un sistema operativo multitarea puede hacer que parezca que cada tarea se ejecuta simultáneamente. Esto es lo que se representa en el diagrama de la Figura siguiente que muestra el patrón de ejecución de tres tareas con respecto al tiempo. Los nombres de las tareas están codificados por colores y escritos a la izquierda. El tiempo se mueve de izquierda a derecha y las líneas de colores muestran qué tarea se está ejecutando en un momento determinado. El diagrama superior demuestra el patrón de ejecución concurrente percibido, y el inferior el patrón de ejecución multitarea real.</p> <p><center></p> <p><img alt="Patrón de ejecución de tres tareas con respecto al tiempo" src=../img/img/Actividad-03/patron.png></p> <p><em>Patrón de ejecución de tres tareas con respecto al tiempo</em></p> <p></center></p> <h3 id=programacion><font color=#AA0000>Programación</font><a class=headerlink href=#programacion title="Permanent link">&para;</a></h3> <p>El programador es quien debe decidir qué tarea debe ejecutarse en un momento determinado. El kernel o núcleo puede suspender y luego reanudar una tarea muchas veces durante el tiempo de vida de la tarea.</p> <p>Además de ser suspendida involuntariamente por el núcleo o kernel, una tarea puede optar por suspenderse a sí misma. Hará esto si desea retrasar (<strong>dormir</strong>) por un período fijo o esperar (<strong>bloquear</strong>) a que un recurso (por ejemplo, un puerto serie) esté disponible, o que ocurra un evento (por ejemplo, presionar una pulsador). Una tarea bloqueada o inactiva no se puede ejecutar y no se le asignará ningún tiempo de procesamiento.</p> <p>En la Figura siguiente vemos un posible diagrama de ejecución de tres tareas analizado punto por punto en distintos instantes de tiempo. En los círculos se representan los instantes de tiempo t1 a t10.</p> <p><center></p> <p><img alt="Diagrama de ejecución de tres tareas en el tiempo" src=../img/img/Actividad-03/diagrama.png></p> <p><em>Diagrama de ejecución de tres tareas en el tiempo</em></p> <p></center></p> <ul> <li><strong>t1:</strong> la <font color=#FF0000>tarea 1 </font> se está ejecutando.</li> <li><strong>t2:</strong> en el kernel se suspende, o mejor dicho se intercambia, la <font color=#FF0000>tarea 1 </font>.</li> <li><strong>t3:</strong> se reanuda la <font color=#0000FF>tarea 2</font>.</li> <li><strong>t4:</strong> mientras se ejecuta la <font color=#0000FF>tarea 2</font> el procesador bloquea el puerto serie para su acceso exclusivo.</li> <li><strong>t5:</strong> el kernel suspende la <font color=#0000FF>tarea 2</font>.</li> <li><strong>t6:</strong> el kernel reanuda la <font color=#309965>tarea 3</font>.</li> <li><strong>t1:</strong> la <font color=#309965>tarea 3</font> intenta acceder al puerto serie y lo encuentra bloqueado por lo que no puede continuar y se suspende.</li> <li><strong>t8:</strong> el kernel reanuda la <font color=#FF0000>tarea 1 </font>.</li> <li><strong>t9:</strong> al ejecutarse de nuevo la <font color=#0000FF>tarea 2</font> se desbloquea el puerto serie.</li> <li><strong>t10:</strong> la <font color=#309965>tarea 3</font> ahora si puede acceder al puerto serie y se ejecuta al completo</li> </ul> <h3 id=planificadores><font color=#AA0000>Planificadores</font><a class=headerlink href=#planificadores title="Permanent link">&para;</a></h3> <p>Los planificadores de multitarea permiten asignar a cada tarea una prioridad, para así darle preferencia a las tareas más críticas o que necesitan más tiempo de procesamiento. Si creamos muchas tareas con “alta” prioridad puede que afectemos a las demás dejando poco tiempo de procesamiento para ellas. En la Figura siguiente vemos un esquema de varias tareas con distintas prioridades, variando así su tiempo de microprocesador asignado.</p> <p><center></p> <p><img alt="Distintas prioridades en tres tareas" src=../img/img/Actividad-03/planificadores.png></p> <p><em>Distintas prioridades en tres tareas</em></p> <p></center></p> <p>Cada tarea tiene su propio espacio de memoria, por lo que crear demasiadas tareas también puede dejarnos el procesador sin memoria. Si la memoria asignada a las tareas tampoco es suficiente para almacenar los datos se podría reiniciar de forma inesperada el Arduino, o funcionar incorrectamente, es decir que como siempre, hay que ser consciente de los limitados recursos de los que disponemos.</p> <h3 id=semaforos><font color=#AA0000>Semáforos</font><a class=headerlink href=#semaforos title="Permanent link">&para;</a></h3> <p>Con la introducción teórica a la multitarea vista, debemos hacernos otra pregunta: ¿Qué pasa si una tarea accede a un recurso o variable, y el sistema multitarea le da el control a otra tarea y por tanto ese proceso falla o quizás otra tarea acceda al mismo recurso y se solapen?</p> <p>Para ese problema de convivencia entre tareas se inventaron los “semáforos”, en concreto el que más nos interesa es el semáforo “mutex” o de exclusión mutua, que permite que bloqueemos el sistema multitarea, hagamos lo que tengamos que hacer crítico, y luego liberemos el control. Por supuesto estas tareas críticas deben ser lo más cortas y atómicas posibles: una escritura crítica en una variable, un envío de un dato, una actualización de una pantalla LCD,... siempre cosas simples. Los semáforos debemos usarlos en casos que tengamos claro que se pueden crear conflictos, pues su abuso puede hacer que el sistema multitarea empiece a fallar.</p> <p>En la Figura siguiente vemos el esquema de acceso a un recurso desde dos tareas diferentes.</p> <p><center></p> <p><img alt="Esquema de acceso a un mismo recurso por parte de 2 tareas diferentes" src=../img/img/Actividad-03/semaforo.png></p> <p><em>Esquema de acceso a un mismo recurso por parte de 2 tareas diferentes</em></p> <p></center></p> <h3 id=en-la-esp32-steamakers><font color=#AA0000>En la ESP32 STEAMakers</font><a class=headerlink href=#en-la-esp32-steamakers title="Permanent link">&para;</a></h3> <p>Una ventaja que posee la ESP32 Plus STEAMakers es que, al estar basado en un ESP32 con dos microcontroladores internos, podemos hacer que cada microcontrolador trabaje en una tarea y esto si sería multitarea real, o en varias tareas mezclando la multitarea real con la simulada. Esto también se puede hacer en las placas Arduino UNO, pero con el ESP32 tenemos más potencia para realizar estas tareas.</p> <h3 id=bloques-esperar><font color=#AA0000>Bloques esperar</font><a class=headerlink href=#bloques-esperar title="Permanent link">&para;</a></h3> <p>¿Qué pasa con los bloques tipo “esperar” que estaban tan prohibidos en la programación de Arduino cuando queríamos simular una multitarea antes de tener estos bloques? Pues seguimos teniéndoles bastante tirria. Aunque en teoría podríamos usarlos, un bloque esperar hace pensar al microcontrolador que está haciendo algo útil, cuando en realidad no es así, por lo que el sistema multitarea querrá asignarle tiempo de procesamiento a la tarea, aunque sea para eso, ¡para no hacer nada!</p> <p>Tenemos una solución, tenemos un nuevo bloque de esperar “task friendly” que en lugar de esperar sin hacer nada le dice al sistema: ¡voy a estar un rato sin hacer nada, permite ejecutar otras tareas mientras y luego vuelves! ….Mucho más “friendly”, claro que sí.</p> <h3 id=bloques><font color=#AA0000>Bloques</font><a class=headerlink href=#bloques title="Permanent link">&para;</a></h3> <p>Con toda esta información pasamos a ver los bloques disponibles para poner todo ésto en marcha.</p> <p><center></p> <table> <thead> <tr> <th align=center>Bloque</th> <th>Descripción</th> </tr> </thead> <tbody> <tr> <td align=center><img alt="Bloque ejecutar tarea" src=../img/img/Actividad-03/B1.png></td> <td>Permite crear una nueva tarea con su bloque de “inicializar” y su “bucle” al igual que la tarea original de Arduino. <br> Debemos asignar una prioridad a cada tarea, por defecto dejaría todas a “baja” y luego iría ajustando si hace falta. <br> Para gestionar mejor las prioridades, es recomendable en algunos casos no utilizar el “inicializar” y “bucle” propio de Arduino que suele tener preferencia sobre todas estas tareas y es más difícil de equilibrar las prioridades.</td> </tr> <tr> <td align=center><img alt="Bloque esperar en esta tarea" src=../img/img/Actividad-03/B2.png></td> <td>El bloque esperar óptimo para tareas, pues deja funcionar al resto de tareas de forma más óptima mientras se espera en ésta. <br>Este bloque tiene menos precisión que el bloque “esperar” original, si necesitamos hacer esperas muy precisas (o de menos de 20 ms) debemos usar el “esperar” tradicional. Pero nos servirá en la mayoría de casos.</td> </tr> <tr> <td align=center><img alt="Bloque bloqueo exclusivo" src=../img/img/Actividad-03/B3.png></td> <td>Si tenemos que hacer alguna acción crítica que no queremos que sea interrumpida internamente por el planificador del sistema multitarea podemos poner este bloque y dentro los bloques críticos. (no utilizar si no es estrictamente necesario)</td> </tr> <tr> <td align=center><img alt="Bloque establecer memoria" src=../img/img/Actividad-03/B4.png></td> <td>Cada tarea tiene su propio espacio de memoria reservado, esta es la cantidad por defecto para las tareas (192 bytes), si necesitamos ajustarla podemos utilizar este bloque en el “inicializar” principal y se ajustará para todas las tareas. <br>Un mal ajuste puede provocar reinicios del microcontrolador o mal funcionamiento.</td> </tr> <tr> <td align=center><img alt="Bloque y destruir tarea" src=../img/img/Actividad-03/B5.png></td> <td>Las tareas en principio, igual que el bucle de Arduino, están pensadas para ejecutarse de forma indefinida, si en un caso una tarea deja de ser necesaria la forma de terminarla es con este bloque que parará la ejecución y liberará la memoria de la tarea en la que se ejecuta.</td> </tr> </tbody> </table> <p></center></p> <h2 id=en-la-tdr-steam><font color=#007575>En la TdR STEAM</font><a class=headerlink href=#en-la-tdr-steam title="Permanent link">&para;</a></h2> <p><center></p> <p><img alt="Los dos LEDs de la TdR-STEAM" src=../img/img/Actividad-02/rojo-azul.png></p> <p><em>Los dos LEDs de la TdR-STEAM</em></p> <p></center></p> <h2 id=programando-la-actividad><font color=#007575>Programando la Actividad</font><a class=headerlink href=#programando-la-actividad title="Permanent link">&para;</a></h2> <p>Vamos a hacer que los dos diodos parpadeen de forma independiente con un programa como el siguiente, que lo tenemos disponible en <a href=../programas/ESP32-SM-Actividad-03.abp>Actividad-03. Parpadeo intermitente. Multitarea</a></p> <p><center></p> <p><img alt="Intermitencia LEDs rojo y azul" src=../img/img/Actividad-03/Parpadeo_intermitente_multitarea.png></p> <p><em>Intermitencia LEDs rojo y azul</em></p> <p></center></p> <h2 id=retos-de-ampliacion><font color=#007575>Retos de ampliación</font><a class=headerlink href=#retos-de-ampliacion title="Permanent link">&para;</a></h2> <p><strong>A3.R1</strong>. Hacer que los LEDs rojo y azul trabajen en multitarea modificando los tiempos.</p> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Pie> <a href=../A02/ class="md-footer__link md-footer__link--prev" aria-label="Anterior: Actividad-02. LEDs rojo y azul" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Anterior </span> Actividad-02. LEDs rojo y azul </div> </div> </a> <a href=../A04/ class="md-footer__link md-footer__link--next" aria-label="Siguiente: Actividad-04. LED RGB" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Siguiente </span> Actividad-04. LED RGB </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2020 - 2035 Federico Coca </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://twitter.com/fgcoca target=_blank rel=noopener title="Twitter de Federico Coca" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://github.com/fgcoca target=_blank rel=noopener title="Github de Federico Coca" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href="https://www.instagram.com/cocafederico/?hl=es" target=_blank rel=noopener title="Instagram de Federico Coca" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg> </a> <a href=https://twitter.com/clubroboticagra target=_blank rel=noopener title="Twitter de Club Robótica Granada" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.config.lang": "es", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "B\u00fasqueda", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version.title": "Seleccionar versi\u00f3n"}}</script> <script src=../assets/javascripts/bundle.078830c0.min.js></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>